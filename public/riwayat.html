<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Riwayat pembelian</title>
  <link href="./output.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <script src="https://cdn.tailwind.com"></script>
</head>
<body class="bg-gray-100 pt-24">
  <!-- Navbar -->
  <nav class="bg-gray-800 text-white px-6 py-4 flex justify-between items-center fixed top-0 left-0 right-0 z-50">
    <div class="flex items-center gap-3">
      <a href="home.html" class="text-white hover:text-blue-400 flex items-center">
        <ion-icon name="arrow-back" class="text-3xl"></ion-icon>
        <span class="ml-2 text-xl font-bold">ZYNTEK</span>
      </a>
    </div>
    <div class="relative w-96">
      <input id="search-input" type="text" placeholder="Pencarian" class="w-full px-3 py-1 rounded-md text-gray-600 placeholder:gray-400" />
      <div id="search-results" class="absolute mt-2 w-full bg-white shadow-lg rounded-md z-50 hidden max-h-64 overflow-y-auto"></div>
    </div>
    <div class="flex items-center gap-4">
      <button onclick="bukaPopup()" class="relative text-white hover:text-blue-400">
        <ion-icon name="cart-outline" size="large"></ion-icon>
        <span id="jumlah-item" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full hidden">0</span>
      </button>
      <a href="profil.html" class="text-white hover:text-blue-400">
        <ion-icon name="person-outline" size="large"></ion-icon>
      </a>
    </div>
  </nav>
    <!-- Container history -->
    <div id="history-list" class="space-y-4 mt-32 max-w-4xl mx-auto"></div>

    <script>
// Kurs konversi USD ke IDR
const kursIDR = 15000;

// Format tanggal ke format YYYY / DD / MM
function formatTanggal(dateStr) {
    const date = new Date(dateStr);
    const year = date.getFullYear();
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    return `${year} / ${day} / ${month}`;
}

async function loadRiwayat() {
    const container = document.getElementById("history-list");
    const history = JSON.parse(localStorage.getItem("history")) || [];

    if (history.length === 0) {
        container.innerHTML = `<p class="text-gray-500 text-center">Belum ada riwayat pembelian.</p>`;
        return;
    }

    let products = [];
    try {
        const response = await fetch("https://fakestoreapi.com/products");
        products = await response.json();
    } catch (error) {
        container.innerHTML = `<p class="text-red-500 text-center">Gagal memuat data produk.</p>`;
        return;
    }

    container.innerHTML = ""; // Clear existing

    history.forEach(item => {
        const product = products.find(p => p.id === item.productId);
        if (!product) return; // Jika produk tidak ditemukan, skip

        // Konversi harga USD ke IDR dan kalikan jumlah
        const totalIDR = (product.price * kursIDR * item.quantity);

        const card = document.createElement("div");
        card.className = "bg-white rounded shadow p-4 flex gap-4 items-start";

        card.innerHTML = `
      <div class="text-xl mt-1">ðŸ“…</div>
      <div class="w-full">
        <div class="flex gap-4 flex-wrap md:flex-nowrap">
          <img src="${product.image}" class="w-24 h-24 object-contain" alt="${product.title}" />
          <div class="flex-1 min-w-0">
            <p class="text-gray-500 text-sm">${formatTanggal(item.date)}</p>
            <h2 class="font-semibold text-lg text-black-900 truncate">${product.title}</h2>
            <p class="text-sm text-gray-700">Size: ${item.size || 'M'}</p>
            <p class="text-sm">x${item.quantity}</p>
          </div>
          <div class="text-right min-w-[100px]">
            <p class="font-semibold text-black-800">Total:</p>
            <p class="font-bold text-lg text-black-900">Rp${totalIDR.toLocaleString('id-ID')}</p>
            <button onclick="hapusRiwayat(${item.productId}, '${item.date}')"
                class="text-sm text-white bg-blue-600 px-2 py-1 rounded hover:bg-red-500 mt-2">
                Hapus
            </button>
          </div>
        </div>
      </div>
    `;

        container.appendChild(card);
    });
}

function hapusRiwayat(productId, date) {
    let history = JSON.parse(localStorage.getItem("history")) || [];

    // Filter yang bukan produk & tanggal yang dimaksud
    history = history.filter(item => !(item.productId === productId && item.date === date));

    // Simpan ulang ke localStorage
    localStorage.setItem("history", JSON.stringify(history));

    // Refresh tampilan
    loadRiwayat();
}

loadRiwayat();

    </script>

</body>

</html>
